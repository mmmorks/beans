# Beans Usage Guide for Agents

> **Context Recovery**: Run `beans prime` after compaction, clear, or new session

This project uses **beans**, an agentic-first issue tracker. Issues are called "beans".

<EXTREMELY_IMPORTANT>

## Core Rules

- **Default**: Use beans for ALL task tracking (`beans create`, `beans list --ready`, `beans update`)
- **Prohibited**: Do NOT use TodoWrite, TaskCreate, or markdown files for task tracking
- **Workflow**: Check for existing beans BEFORE writing code; create one if none exists
- All commands support `--json` for machine-readable output

## Session Close Protocol

**CRITICAL**: Before ending a session, you MUST complete this checklist:

```
[ ] 1. git status                    # Check what changed
[ ] 2. git add <files>               # Stage code AND bean files
[ ] 3. git commit -m "..."           # Commit with bean ID in message
[ ] 4. beans update <id> -s completed  # Mark bean done (if work complete)
```

**NEVER skip this.** Work is not done until committed and beans are updated.

</EXTREMELY_IMPORTANT>

## Finding Work

```bash
beans list --json --ready              # Unblocked beans ready to start
beans list --json -s in-progress       # Your active work
beans show --json <id> [id...]         # View full details (supports multiple IDs)
beans list --json -S "search term"     # Full-text search
```

## Creating & Updating

```bash
# Create (always specify -t type)
beans create --json "Title" -t task -d "Description..." -s in-progress

# Update status
beans update --json <id> -s in-progress   # Claim work
beans update --json <id> -s completed     # Mark done

# Update body content
beans update <id> --body-replace-old "- [ ] Task" --body-replace-new "- [x] Task"
beans update <id> --body-append "## Notes\n\nContent here"
```

**Shell escaping**: Always escape backticks in titles/descriptions: `\`` not `` ` ``

## Relationships & Dependencies

- `--parent <id>` - Set hierarchy (milestone → epic → feature → task/bug)
- `--blocked-by <id>` - This bean can't start until other completes (prefer this)
- `--blocking <id>` - This bean blocks another from starting

```bash
beans update <id> --parent <parent-id>
beans update <id> --blocked-by <other-id>
```

## Git Integration

Beans auto-creates git branches for **parent beans** (beans with children) following GitHub Flow.

**Workflow:**
1. Create parent bean with children → `beans create "Epic" -t epic && beans create "Task" --parent <epic-id>`
2. Start work → `beans update <parent-id> -s in-progress` (auto-creates branch)
3. Do work, commit code AND beans together
4. Merge PR via GitHub
5. Sync status → `beans sync --json --apply` (marks bean completed)

**Commands:**
```bash
beans sync --json           # Preview what would change (dry-run)
beans sync --json --apply   # Apply changes (merged → completed, deleted → scrapped)
```

**Troubleshooting:**
- "dirty working tree" error → commit your changes first
- Branch not created → bean needs children (only parent beans get branches)

## Issue Types
{{range .Types}}
- **{{.Name}}**{{if .Description}}: {{.Description}}{{end}}
{{- end}}

## Statuses
{{range .Statuses}}
- **{{.Name}}**{{if .Description}}: {{.Description}}{{end}}
{{- end}}

## Priorities

Use `-p` when creating or `--priority` when updating:
{{range .Priorities}}
- **{{.Name}}**{{if .Description}}: {{.Description}}{{end}}
{{- end}}

## Common Workflows

**Starting a task:**
```bash
beans list --json --ready        # Find available work
beans show --json <id>           # Review details
beans update <id> -s in-progress # Claim it
# ... do the work ...
beans update <id> -s completed   # Mark done
```

**Creating dependent work:**
```bash
beans create "Feature X" -t feature --json
beans create "Tests for X" -t task --blocked-by <feature-id> --json
```

**Checking off todo items:**
```bash
beans update <id> --body-replace-old "- [ ] Implement API" --body-replace-new "- [x] Implement API"
```

## Advanced: GraphQL Queries

For complex queries, use `beans query`:

```bash
# All actionable beans
beans query --json '{ beans(filter: { excludeStatus: ["completed", "scrapped"], isBlocked: false }) { id title status } }'

# Bean with relationships
beans query --json '{ bean(id: "<id>") { title body parent { title } children { id title } } }'
```

Use `beans query --schema` for full schema.
